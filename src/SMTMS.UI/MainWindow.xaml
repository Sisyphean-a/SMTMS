<Window
    Height="800"
    Title="{Binding ApplicationTitle}"
    Width="1200"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d"
    x:Class="SMTMS.UI.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:SMTMS.UI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Margin="10">
            <StackPanel Margin="0,0,0,10" Orientation="Horizontal">
                <Button
                    Command="{Binding ModListViewModel.LoadModsCommand}"
                    Content="扫描模组"
                    Margin="0,0,10,0"
                    Padding="10,5"
                    ToolTip="重新加载模组列表。" />
                <TextBox
                    Text="{Binding ModsDirectory}"
                    ToolTip="模组目录路径。"
                    VerticalContentAlignment="Center"
                    Width="400" />
                <Button
                    Command="{Binding BrowseFolderCommand}"
                    Content="浏览..."
                    Margin="5,0,0,0"
                    Padding="10,5"
                    ToolTip="选择模组目录。" />
            </StackPanel>

            <StackPanel Margin="0,0,0,10" Orientation="Horizontal">
                <Button
                    Background="#9C27B0"
                    BorderThickness="0"
                    Command="{Binding SyncToDatabaseCommand}"
                    Content="同步到数据库"
                    Foreground="White"
                    Margin="0,0,10,0"
                    Padding="10,5"
                    ToolTip="扫描本地模组，将中文翻译保存到数据库。" />
                <Button
                    Background="#4CAF50"
                    BorderThickness="0"
                    Command="{Binding RestoreFromDatabaseCommand}"
                    Content="从数据库恢复"
                    Foreground="White"
                    Margin="0,0,10,0"
                    Padding="10,5"
                    ToolTip="从数据库读取翻译并应用到本地文件。" />
                <Button
                    Background="#607D8B"
                    BorderThickness="0"
                    Command="{Binding HardResetCommand}"
                    Content="初始化(测试用)"
                    Foreground="White"
                    Margin="0,0,10,0"
                    Padding="10,5"
                    ToolTip="清空所有数据和历史，重置为初始状态。" />
            </StackPanel>

            <TextBlock
                Foreground="Gray"
                Text="{Binding StatusMessage}"
                VerticalAlignment="Center" />
        </StackPanel>

        <TabControl Grid.Row="1" Margin="10">
            <TabItem Header="模组列表">
                <Grid Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="10" />
                        <ColumnDefinition Width="1*" />
                    </Grid.ColumnDefinitions>

                    <DataGrid
                        AutoGenerateColumns="False"
                        BorderBrush="LightGray"
                        BorderThickness="1"
                        Grid.Column="0"
                        IsReadOnly="True"
                        ItemsSource="{Binding ModListViewModel.Mods}"
                        SelectedItem="{Binding ModListViewModel.SelectedMod}">
                        <DataGrid.Columns>
                            <DataGridTextColumn
                                Binding="{Binding Name}"
                                Header="名称"
                                Width="200" />
                            <DataGridTextColumn
                                Binding="{Binding Version}"
                                Header="版本"
                                Width="80" />
                            <DataGridTextColumn
                                Binding="{Binding UniqueID}"
                                Header="ID"
                                Width="200" />
                            <DataGridTextColumn
                                Binding="{Binding Description}"
                                Header="描述"
                                Width="*" />
                        </DataGrid.Columns>
                        <DataGrid.ItemContainerStyle>
                            <Style TargetType="DataGridRow">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding TranslationStatus}" Value="New / Untracked">
                                        <Setter Property="Foreground" Value="Gray" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding TranslationStatus}" Value="Changed (Local differs from DB)">
                                        <Setter Property="Foreground" Value="#007ACC" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.ItemContainerStyle>
                    </DataGrid>

                    <GridSplitter
                        Background="Transparent"
                        Grid.Column="1"
                        HorizontalAlignment="Center"
                        ShowsPreview="True"
                        VerticalAlignment="Stretch"
                        Width="5" />

                    <Border
                        Background="White"
                        BorderBrush="LightGray"
                        BorderThickness="1"
                        CornerRadius="3"
                        Grid.Column="2"
                        Padding="15">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Visibility" Value="Visible" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ModListViewModel.SelectedMod}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Hidden" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel>
                                <TextBlock
                                    FontSize="18"
                                    FontWeight="SemiBold"
                                    Margin="0,0,0,15"
                                    Text="编辑模组详情" />

                                <TextBlock
                                    FontWeight="Medium"
                                    Foreground="DimGray"
                                    Text="名称" />
                                <TextBox
                                    Margin="0,5,0,15"
                                    Padding="5"
                                    Text="{Binding ModListViewModel.SelectedMod.Name, UpdateSourceTrigger=Explicit}"
                                    x:Name="NameTextBox" />

                                <TextBlock
                                    FontWeight="Medium"
                                    Foreground="DimGray"
                                    Text="作者" />
                                <TextBox
                                    Background="#F5F5F5"
                                    IsReadOnly="True"
                                    Margin="0,5,0,15"
                                    Padding="5"
                                    Text="{Binding ModListViewModel.SelectedMod.Author, UpdateSourceTrigger=Explicit}"
                                    ToolTip="Author cannot be changed."
                                    x:Name="AuthorTextBox" />

                                <TextBlock
                                    FontWeight="Medium"
                                    Foreground="DimGray"
                                    Text="版本" />
                                <TextBox
                                    Background="#F5F5F5"
                                    IsReadOnly="True"
                                    Margin="0,5,0,15"
                                    Padding="5"
                                    Text="{Binding ModListViewModel.SelectedMod.Version, UpdateSourceTrigger=Explicit}"
                                    ToolTip="Version cannot be changed."
                                    x:Name="VersionTextBox" />

                                <TextBlock
                                    FontWeight="Medium"
                                    Foreground="DimGray"
                                    Text="唯一ID" />
                                <TextBox
                                    Background="#F5F5F5"
                                    IsReadOnly="True"
                                    Margin="0,5,0,15"
                                    Padding="5"
                                    Text="{Binding ModListViewModel.SelectedMod.UniqueID, UpdateSourceTrigger=Explicit}"
                                    ToolTip="Mod ID cannot be changed safely." />

                                <TextBlock
                                    FontWeight="Medium"
                                    Foreground="DimGray"
                                    Text="描述" />
                                <TextBox
                                    AcceptsReturn="True"
                                    Height="120"
                                    Margin="0,5,0,15"
                                    Padding="5"
                                    Text="{Binding ModListViewModel.SelectedMod.Description, UpdateSourceTrigger=Explicit}"
                                    TextWrapping="Wrap"
                                    VerticalScrollBarVisibility="Auto"
                                    x:Name="DescriptionTextBox" />

                                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                                    <Button
                                        Background="#673AB7"
                                        BorderThickness="0"
                                        Command="{Binding ModListViewModel.SelectedMod.ShowHistoryCommand}"
                                        Content="查看历史"
                                        Cursor="Hand"
                                        Foreground="White"
                                        Margin="0,0,10,0"
                                        Padding="20,8">
                                        <Button.Resources>
                                            <Style TargetType="Border">
                                                <Setter Property="CornerRadius" Value="3" />
                                            </Style>
                                        </Button.Resources>
                                    </Button>
                                    <Button
                                        Background="#007ACC"
                                        BorderThickness="0"
                                        Command="{Binding ModListViewModel.SaveModCommand}"
                                        Content="保存更改"
                                        Cursor="Hand"
                                        Foreground="White"
                                        Padding="20,8">
                                        <Button.Resources>
                                            <Style TargetType="Border">
                                                <Setter Property="CornerRadius" Value="3" />
                                            </Style>
                                        </Button.Resources>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </Border>

                    <TextBlock
                        FontSize="14"
                        FontStyle="Italic"
                        Foreground="Gray"
                        Grid.Column="2"
                        HorizontalAlignment="Center"
                        Text="选择一个模组以编辑详情"
                        VerticalAlignment="Center">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Hidden" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ModListViewModel.SelectedMod}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </Grid>
            </TabItem>

            <TabItem Header="历史记录">
                <Grid Margin="0,10,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!--  操作按钮  -->
                    <StackPanel
                        Grid.Row="0"
                        Margin="0,0,0,10"
                        Orientation="Horizontal">
                        <Button
                            Command="{Binding HistoryViewModel.LoadHistoryCommand}"
                            Content="刷新列表"
                            Margin="0,0,10,0"
                            Padding="10,5"
                            ToolTip="刷新 Git 提交历史列表。" />
                        <Button
                            Background="#E74C3C"
                            BorderThickness="0"
                            Command="{Binding HistoryViewModel.GitRollbackCommand}"
                            Content="回滚到选中"
                            Foreground="White"
                            Margin="0,0,10,0"
                            Padding="10,5"
                            ToolTip="将文件恢复到选中提交的状态。警告：这是破坏性操作！" />
                    </StackPanel>

                    <!--  提交历史列表  -->
                    <DataGrid
                        AutoGenerateColumns="False"
                        BorderBrush="LightGray"
                        BorderThickness="1"
                        Grid.Row="1"
                        Height="150"
                        IsReadOnly="True"
                        ItemsSource="{Binding HistoryViewModel.CommitHistory}"
                        Margin="0,0,0,10"
                        SelectedItem="{Binding HistoryViewModel.SelectedCommit}">
                        <DataGrid.Columns>
                            <DataGridTextColumn
                                Binding="{Binding ShortHash}"
                                Header="哈希"
                                Width="70" />
                            <DataGridTextColumn
                                Binding="{Binding Message}"
                                Header="信息"
                                Width="*" />
                            <DataGridTextColumn
                                Binding="{Binding Author}"
                                Header="作者"
                                Width="120" />
                            <DataGridTextColumn
                                Binding="{Binding FormattedDate}"
                                Header="日期"
                                Width="150" />
                        </DataGrid.Columns>
                    </DataGrid>

                    <!--  变更详情区域  -->
                    <Grid Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*" />
                            <ColumnDefinition Width="5" />
                            <ColumnDefinition Width="2*" />
                        </Grid.ColumnDefinitions>

                        <!--  左侧：变更列表（使用 DataGrid）  -->
                        <DataGrid
                            AutoGenerateColumns="False"
                            BorderBrush="LightGray"
                            BorderThickness="1"
                            EnableRowVirtualization="True"
                            Grid.Column="0"
                            HeadersVisibility="Column"
                            IsReadOnly="True"
                            ItemsSource="{Binding HistoryViewModel.ModDiffChanges}"
                            SelectedItem="{Binding HistoryViewModel.SelectedDiffItem}"
                            VirtualizingPanel.IsVirtualizing="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn
                                    Binding="{Binding Icon}"
                                    Header=""
                                    Width="30" />
                                <DataGridTextColumn
                                    Binding="{Binding ModName}"
                                    Header="模组名称"
                                    Width="200" />
                                <DataGridTextColumn
                                    Binding="{Binding FolderName}"
                                    Header="文件夹"
                                    Width="150" />
                                <DataGridTemplateColumn Header="变更内容" Width="*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Margin="5,3">
                                                <!--  名称变更  -->
                                                <TextBlock Margin="0,2">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding NameChange.HasChange}" Value="True">
                                                                    <Setter Property="Visibility" Value="Visible" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                    <Run
                                                        FontWeight="SemiBold"
                                                        Foreground="#673AB7"
                                                        Text="名称: " />
                                                    <Run Foreground="DimGray" Text="{Binding NameChange.ChangeSummary, Mode=OneWay}" />
                                                </TextBlock>

                                                <!--  描述变更  -->
                                                <TextBlock Margin="0,2">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding DescriptionChange.HasChange}" Value="True">
                                                                    <Setter Property="Visibility" Value="Visible" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                    <Run
                                                        FontWeight="SemiBold"
                                                        Foreground="#673AB7"
                                                        Text="描述: " />
                                                    <Run Foreground="DimGray" Text="{Binding DescriptionChange.ChangeSummary, Mode=OneWay}" />
                                                </TextBlock>

                                                <!--  作者变更  -->
                                                <TextBlock Margin="0,2">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding AuthorChange.HasChange}" Value="True">
                                                                    <Setter Property="Visibility" Value="Visible" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                    <Run
                                                        FontWeight="SemiBold"
                                                        Foreground="#673AB7"
                                                        Text="作者: " />
                                                    <Run Foreground="DimGray" Text="{Binding AuthorChange.ChangeSummary, Mode=OneWay}" />
                                                </TextBlock>

                                                <!--  版本变更  -->
                                                <TextBlock Margin="0,2">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding VersionChange.HasChange}" Value="True">
                                                                    <Setter Property="Visibility" Value="Visible" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                    <Run
                                                        FontWeight="SemiBold"
                                                        Foreground="#673AB7"
                                                        Text="版本: " />
                                                    <Run Foreground="DimGray" Text="{Binding VersionChange.ChangeSummary, Mode=OneWay}" />
                                                </TextBlock>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!--  加载提示覆盖层  -->
                        <Border
                            Background="#F0FFFFFF"
                            Grid.Column="0"
                            Panel.ZIndex="100">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding HistoryViewModel.IsLoadingDiff}" Value="True">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock
                                    FontSize="48"
                                    HorizontalAlignment="Center"
                                    Margin="0,0,0,10"
                                    Text="⏳" />
                                <TextBlock
                                    FontSize="14"
                                    Foreground="#007ACC"
                                    HorizontalAlignment="Center"
                                    Text="{Binding HistoryViewModel.DiffLoadingMessage}" />
                            </StackPanel>
                        </Border>

                        <GridSplitter
                            Background="Transparent"
                            Grid.Column="1"
                            HorizontalAlignment="Center"
                            ShowsPreview="True"
                            VerticalAlignment="Stretch"
                            Width="5" />

                        <!--  右侧：详情面板  -->
                        <Border
                            Background="White"
                            BorderBrush="LightGray"
                            BorderThickness="1"
                            CornerRadius="3"
                            Grid.Column="2"
                            Padding="10">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <Grid>
                                    <!--  未选中状态  -->
                                    <TextBlock
                                        FontSize="14"
                                        FontStyle="Italic"
                                        Foreground="Gray"
                                        HorizontalAlignment="Center"
                                        Margin="0,50,0,0"
                                        Text="← 选择一个模组查看详细变更"
                                        VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HistoryViewModel.SelectedDiffItem}" Value="{x:Null}">
                                                        <Setter Property="Visibility" Value="Visible" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>

                                    <!--  已选中状态  -->
                                    <StackPanel>
                                        <StackPanel.Style>
                                            <Style TargetType="StackPanel">
                                                <Setter Property="Visibility" Value="Visible" />
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HistoryViewModel.SelectedDiffItem}" Value="{x:Null}">
                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </StackPanel.Style>

                                        <!--  模组基本信息  -->
                                        <Border
                                            Background="#F9F9F9"
                                            CornerRadius="3"
                                            Margin="0,0,0,10"
                                            Padding="10">
                                            <StackPanel>
                                                <TextBlock
                                                    FontSize="16"
                                                    FontWeight="SemiBold"
                                                    Margin="0,0,0,8"
                                                    Text="模组详情" />
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                    </Grid.RowDefinitions>

                                                    <TextBlock
                                                        FontWeight="Medium"
                                                        Foreground="DimGray"
                                                        Grid.Column="0"
                                                        Grid.Row="0"
                                                        Margin="0,0,10,4"
                                                        Text="模组名称：" />
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        Grid.Row="0"
                                                        Margin="0,0,0,4"
                                                        Text="{Binding HistoryViewModel.SelectedDiffItem.ModName}"
                                                        TextWrapping="Wrap" />

                                                    <TextBlock
                                                        FontWeight="Medium"
                                                        Foreground="DimGray"
                                                        Grid.Column="0"
                                                        Grid.Row="1"
                                                        Margin="0,0,10,4"
                                                        Text="唯一ID：" />
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        Grid.Row="1"
                                                        Margin="0,0,0,4"
                                                        Text="{Binding HistoryViewModel.SelectedDiffItem.UniqueID}"
                                                        TextWrapping="Wrap" />

                                                    <TextBlock
                                                        FontWeight="Medium"
                                                        Foreground="DimGray"
                                                        Grid.Column="0"
                                                        Grid.Row="2"
                                                        Margin="0,0,10,4"
                                                        Text="文件夹：" />
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        Grid.Row="2"
                                                        Margin="0,0,0,4"
                                                        Text="{Binding HistoryViewModel.SelectedDiffItem.FolderName}"
                                                        TextWrapping="Wrap" />

                                                    <TextBlock
                                                        FontWeight="Medium"
                                                        Foreground="DimGray"
                                                        Grid.Column="0"
                                                        Grid.Row="3"
                                                        Margin="0,0,10,4"
                                                        Text="变更类型：" />
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        Grid.Row="3"
                                                        Margin="0,0,0,4"
                                                        Text="{Binding HistoryViewModel.SelectedDiffItem.ChangeType}"
                                                        TextWrapping="Wrap" />
                                                </Grid>
                                            </StackPanel>
                                        </Border>

                                        <!--  字段变更详情  -->
                                        <TextBlock
                                            FontSize="15"
                                            FontWeight="SemiBold"
                                            Margin="0,5,0,8"
                                            Text="字段变更" />

                                        <!--  名称变更  -->
                                        <Border
                                            BorderBrush="#E0E0E0"
                                            BorderThickness="1"
                                            CornerRadius="3"
                                            Margin="0,0,0,8"
                                            Padding="8">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HistoryViewModel.SelectedDiffItem.NameChange.HasChange}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <StackPanel>
                                                <TextBlock
                                                    FontWeight="SemiBold"
                                                    Foreground="#673AB7"
                                                    Margin="0,0,0,4"
                                                    Text="名称 (Name)" />
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                                        <TextBlock
                                                            FontSize="11"
                                                            FontWeight="Medium"
                                                            Foreground="DimGray"
                                                            Text="旧值：" />
                                                        <TextBox
                                                            Background="#FFF3E0"
                                                            BorderThickness="0"
                                                            IsReadOnly="True"
                                                            Margin="0,2,0,0"
                                                            Padding="5"
                                                            Text="{Binding HistoryViewModel.SelectedDiffItem.NameChange.OldValue, Mode=OneWay}"
                                                            TextWrapping="Wrap" />
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                                        <TextBlock
                                                            FontSize="11"
                                                            FontWeight="Medium"
                                                            Foreground="DimGray"
                                                            Text="新值：" />
                                                        <TextBox
                                                            Background="#E8F5E9"
                                                            BorderThickness="0"
                                                            IsReadOnly="True"
                                                            Margin="0,2,0,0"
                                                            Padding="5"
                                                            Text="{Binding HistoryViewModel.SelectedDiffItem.NameChange.NewValue, Mode=OneWay}"
                                                            TextWrapping="Wrap" />
                                                    </StackPanel>
                                                </Grid>
                                            </StackPanel>
                                        </Border>

                                        <!--  描述变更  -->
                                        <Border
                                            BorderBrush="#E0E0E0"
                                            BorderThickness="1"
                                            CornerRadius="3"
                                            Margin="0,0,0,8"
                                            Padding="8">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HistoryViewModel.SelectedDiffItem.DescriptionChange.HasChange}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <StackPanel>
                                                <TextBlock
                                                    FontWeight="SemiBold"
                                                    Foreground="#673AB7"
                                                    Margin="0,0,0,4"
                                                    Text="描述 (Description)" />
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                                        <TextBlock
                                                            FontSize="11"
                                                            FontWeight="Medium"
                                                            Foreground="DimGray"
                                                            Text="旧值：" />
                                                        <TextBox
                                                            AcceptsReturn="True"
                                                            Background="#FFF3E0"
                                                            BorderThickness="0"
                                                            IsReadOnly="True"
                                                            Margin="0,2,0,0"
                                                            MaxHeight="150"
                                                            MinHeight="40"
                                                            Padding="5"
                                                            Text="{Binding HistoryViewModel.SelectedDiffItem.DescriptionChange.OldValue, Mode=OneWay}"
                                                            TextWrapping="Wrap"
                                                            VerticalScrollBarVisibility="Auto" />
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                                        <TextBlock
                                                            FontSize="11"
                                                            FontWeight="Medium"
                                                            Foreground="DimGray"
                                                            Text="新值：" />
                                                        <TextBox
                                                            AcceptsReturn="True"
                                                            Background="#E8F5E9"
                                                            BorderThickness="0"
                                                            IsReadOnly="True"
                                                            Margin="0,2,0,0"
                                                            MaxHeight="150"
                                                            MinHeight="40"
                                                            Padding="5"
                                                            Text="{Binding HistoryViewModel.SelectedDiffItem.DescriptionChange.NewValue, Mode=OneWay}"
                                                            TextWrapping="Wrap"
                                                            VerticalScrollBarVisibility="Auto" />
                                                    </StackPanel>
                                                </Grid>
                                            </StackPanel>
                                        </Border>

                                        <!--  作者变更  -->
                                        <Border
                                            BorderBrush="#E0E0E0"
                                            BorderThickness="1"
                                            CornerRadius="3"
                                            Margin="0,0,0,8"
                                            Padding="8">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HistoryViewModel.SelectedDiffItem.AuthorChange.HasChange}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <StackPanel>
                                                <TextBlock
                                                    FontWeight="SemiBold"
                                                    Foreground="#673AB7"
                                                    Margin="0,0,0,4"
                                                    Text="作者 (Author)" />
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                                        <TextBlock
                                                            FontSize="11"
                                                            FontWeight="Medium"
                                                            Foreground="DimGray"
                                                            Text="旧值：" />
                                                        <TextBox
                                                            Background="#FFF3E0"
                                                            BorderThickness="0"
                                                            IsReadOnly="True"
                                                            Margin="0,2,0,0"
                                                            Padding="5"
                                                            Text="{Binding HistoryViewModel.SelectedDiffItem.AuthorChange.OldValue, Mode=OneWay}"
                                                            TextWrapping="Wrap" />
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                                        <TextBlock
                                                            FontSize="11"
                                                            FontWeight="Medium"
                                                            Foreground="DimGray"
                                                            Text="新值：" />
                                                        <TextBox
                                                            Background="#E8F5E9"
                                                            BorderThickness="0"
                                                            IsReadOnly="True"
                                                            Margin="0,2,0,0"
                                                            Padding="5"
                                                            Text="{Binding HistoryViewModel.SelectedDiffItem.AuthorChange.NewValue, Mode=OneWay}"
                                                            TextWrapping="Wrap" />
                                                    </StackPanel>
                                                </Grid>
                                            </StackPanel>
                                        </Border>

                                        <!--  版本变更  -->
                                        <Border
                                            BorderBrush="#E0E0E0"
                                            BorderThickness="1"
                                            CornerRadius="3"
                                            Margin="0,0,0,8"
                                            Padding="8">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding HistoryViewModel.SelectedDiffItem.VersionChange.HasChange}" Value="True">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <StackPanel>
                                                <TextBlock
                                                    FontWeight="SemiBold"
                                                    Foreground="#673AB7"
                                                    Margin="0,0,0,4"
                                                    Text="版本 (Version)" />
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0" Margin="0,0,5,0">
                                                        <TextBlock
                                                            FontSize="11"
                                                            FontWeight="Medium"
                                                            Foreground="DimGray"
                                                            Text="旧值：" />
                                                        <TextBox
                                                            Background="#FFF3E0"
                                                            BorderThickness="0"
                                                            IsReadOnly="True"
                                                            Margin="0,2,0,0"
                                                            Padding="5"
                                                            Text="{Binding HistoryViewModel.SelectedDiffItem.VersionChange.OldValue, Mode=OneWay}"
                                                            TextWrapping="Wrap" />
                                                    </StackPanel>

                                                    <StackPanel Grid.Column="1" Margin="5,0,0,0">
                                                        <TextBlock
                                                            FontSize="11"
                                                            FontWeight="Medium"
                                                            Foreground="DimGray"
                                                            Text="新值：" />
                                                        <TextBox
                                                            Background="#E8F5E9"
                                                            BorderThickness="0"
                                                            IsReadOnly="True"
                                                            Margin="0,2,0,0"
                                                            Padding="5"
                                                            Text="{Binding HistoryViewModel.SelectedDiffItem.VersionChange.NewValue, Mode=OneWay}"
                                                            TextWrapping="Wrap" />
                                                    </StackPanel>
                                                </Grid>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
