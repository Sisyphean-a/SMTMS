<Window
    Height="600"
    Title="模组历史记录"
    Width="900"
    WindowStartupLocation="CenterOwner"
    d:DesignHeight="600"
    d:DesignWidth="800"
    mc:Ignorable="d"
    x:Class="SMTMS.Avalonia.Views.ModHistoryWindow"
    x:DataType="vm:ModHistoryViewModel"
    xmlns="https://github.com/avaloniaui"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:SMTMS.Avalonia.ViewModels"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Window.Styles>
        <Style Selector="TextBlock.Spinning">
            <Style.Animations>
                <Animation Duration="0:0:1" IterationCount="Infinite">
                    <KeyFrame Cue="0%">
                        <Setter Property="RotateTransform.Angle" Value="0" />
                    </KeyFrame>
                    <KeyFrame Cue="100%">
                        <Setter Property="RotateTransform.Angle" Value="360" />
                    </KeyFrame>
                </Animation>
            </Style.Animations>
        </Style>
    </Window.Styles>

    <Grid Margin="15" RowDefinitions="*, Auto">
        <!--  History List  -->
        <DataGrid
            AutoGenerateColumns="False"
            BorderBrush="#E1E3E6"
            BorderThickness="1"
            Grid.Row="0"
            GridLinesVisibility="Horizontal"
            HeadersVisibility="Column"
            IsReadOnly="True"
            ItemsSource="{Binding HistoryItems}"
            RowBackground="Transparent"
            SelectedItem="{Binding SelectedHistoryItem}">
            <DataGrid.Styles>
                <Style Selector="DataGridColumnHeader">
                    <Setter Property="Background" Value="#FAFAFA" />
                    <Setter Property="Foreground" Value="#999999" />
                    <Setter Property="FontSize" Value="11" />
                </Style>
            </DataGrid.Styles>
            <DataGrid.Columns>
                <DataGridTextColumn
                    Binding="{Binding SnapshotTime}"
                    FontFamily="{StaticResource MonoFont}"
                    Header="快照时间"
                    Width="180" />
                <DataGridTextColumn
                    Binding="{Binding DisplayName}"
                    Header="名称"
                    Width="*" />
                <DataGridTextColumn
                    Binding="{Binding DisplayDescription}"
                    Header="描述"
                    Width="2*" />
                <DataGridTextColumn
                    Binding="{Binding DisplayAuthor}"
                    Header="作者"
                    Width="120" />
                <DataGridTextColumn
                    Binding="{Binding DisplayVersion}"
                    FontFamily="{StaticResource MonoFont}"
                    Header="版本"
                    Width="100" />
            </DataGrid.Columns>
        </DataGrid>

        <!--  Bottom Actions  -->
        <StackPanel
            Grid.Row="1"
            HorizontalAlignment="Right"
            Margin="0,20,0,0"
            Orientation="Horizontal"
            Spacing="15">
            <TextBlock
                FontFamily="{StaticResource MonoFont}"
                FontSize="11"
                Foreground="#999999"
                Text="[请选择一个版本以恢复元数据]"
                VerticalAlignment="Center" />
            <Button
                Classes="Tertiary"
                Command="{Binding CloseCommand}"
                Content="关闭"
                ToolTip.Tip="关闭窗口"
                AutomationProperties.Name="关闭窗口" />
            <Button
                Classes="Solid"
                Command="{Binding ApplyCommand}"
                Content="应用选中版本"
                IsEnabled="{Binding SelectedHistoryItem, Converter={x:Static ObjectConverters.IsNotNull}}"
                ToolTip.Tip="将选中的历史版本应用到当前模组"
                AutomationProperties.Name="应用选中版本" />
        </StackPanel>

        <!--  Loading Overlay  -->
        <Border
            Background="#EEFFFFFF"
            Grid.Row="0"
            Grid.RowSpan="2"
            IsVisible="{Binding IsLoading}">
            <StackPanel
                HorizontalAlignment="Center"
                Spacing="15"
                VerticalAlignment="Center">
                <TextBlock
                    Classes="Spinning"
                    FontSize="48"
                    HorizontalAlignment="Center"
                    RenderTransformOrigin="50%,50%"
                    Text="⏳">
                    <TextBlock.RenderTransform>
                        <RotateTransform />
                    </TextBlock.RenderTransform>
                </TextBlock>
                <TextBlock
                    FontFamily="{StaticResource MonoFont}"
                    FontSize="16"
                    Foreground="{StaticResource GeekBlueBrush}"
                    HorizontalAlignment="Center"
                    Text="正在获取历史记录..." />
            </StackPanel>
        </Border>
    </Grid>
</Window>
